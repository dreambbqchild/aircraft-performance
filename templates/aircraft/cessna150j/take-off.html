{%- import "macros/percent_between.html" as percent_between -%}
{%- import "macros/percent_of.html" as percent_of -%}
{%- import "macros/cessna150j/temperature_correction.html" as temperature_correction -%}
{%- import "macros/cessna150j/grass_correction.html" as grass_correction -%}
<!DOCTYPE html>
<html>
    <head>
        <title>Take Off</title>
        <link rel="stylesheet" href="/styles.css">
        <script type="text/javascript" src="/scripts/child-main.js"></script>
    </head>
    <body>
        <h2>Take Off</h2>
        <p>
            The airport elevation of {{cessna.elevation_ft}}' is 
            {% call percent_between::render(cessna.elevation_ft, cessna.atmosphere_bounds.lower.altitude, cessna.atmosphere_bounds.upper.altitude, cessna.altitude_tween_percentage, "'") %}
            of the way between {{cessna.atmosphere_bounds.lower.altitude}}' and {{cessna.atmosphere_bounds.upper.altitude}}'.
        </p>
        <p>
            The headwind of {{cessna.headwind_kts}} kts is
            {% call percent_between::render(cessna.headwind_kts, 
                cessna.headwinds.lower_value, 
                cessna.headwinds.upper_value, 
                cessna.headwind_tween_percentage, 
                " kts") 
            %}
            between the lower bound of {{cessna.headwinds.lower_value}} kts and the upper bound of {{cessna.headwinds.upper_value}}kts.
        </p>
        <p>
            The relevant distances are then:
            <table>
                <thead>
                    <tr>
                        <th></th>
                        <th colspan="2">{{cessna.atmosphere_bounds.lower.altitude}}' at {{cessna.atmosphere_bounds.lower.temperature}}째F</th>
                        <th colspan="2">{{cessna.elevation_ft}}' at {{cessna.standard_temperature_f}}째F</th>
                        <th colspan="2">{{cessna.atmosphere_bounds.upper.altitude}}' at {{cessna.atmosphere_bounds.upper.temperature}}째F</th>
                    </tr>
                    <tr>
                        <th>Head Wind</th>
                        <th>Ground Run</th>
                        <th>Total to Clear 50' Obs</th>
                        <th>Ground Run</th>
                        <th>Total to Clear 50' Obs</th>
                        <th>Ground Run</th>
                        <th>Total to Clear 50' Obs</th>             
                    </tr>
                </thead>
                <tbody>
                    {%for (i, row) in calcs.takeoff_distances.iter().enumerate() %}
                    <tr>
                        <td>{{row.wind_speed.expect("wind_speed to be set")}} kts</td>
                        <td>
                            {% if i == 1 %}
                                {% call percent_of::render(
                                    cessna.headwind_tween_percentage,
                                    calcs.takeoff_distances[0].lower_bound.ground_run(), 
                                    calcs.takeoff_distances[2].lower_bound.ground_run(), 
                                    "'")
                                %}
                            {% endif %}
                            {{row.lower_bound.ground_run()}}'
                        </td>
                        <td>
                            {% if i == 1 %}
                                {% call percent_of::render(
                                    cessna.headwind_tween_percentage,
                                    calcs.takeoff_distances[0].lower_bound.clear_50_ft_obstacle(), 
                                    calcs.takeoff_distances[2].lower_bound.clear_50_ft_obstacle(), 
                                    "'")
                                %}
                            {% endif %}
                            {{row.lower_bound.clear_50_ft_obstacle()}}'
                        </td>
                        <td>
                            {% if i == 1%}
                                {% call percent_of::render(
                                    cessna.headwind_tween_percentage,
                                    calcs.takeoff_distances[0].middle_value.ground_run(), 
                                    calcs.takeoff_distances[2].middle_value.ground_run(), 
                                    "'")
                                %}
                            {% else %}
                                    {% call percent_of::render(
                                        cessna.altitude_tween_percentage,
                                        row.lower_bound.ground_run(), 
                                        row.upper_bound.ground_run(), 
                                        "'")
                                    %}
                            {% endif %}
                            {{row.middle_value.ground_run()}}'
                        </td>
                        <td>
                            {% if i == 1 %}
                                {% call percent_of::render(
                                    cessna.headwind_tween_percentage,
                                    calcs.takeoff_distances[0].middle_value.clear_50_ft_obstacle(), 
                                    calcs.takeoff_distances[2].middle_value.clear_50_ft_obstacle(), 
                                    "'")
                                %}
                            {% else %}
                                {% call percent_of::render(
                                    cessna.altitude_tween_percentage,
                                    row.lower_bound.clear_50_ft_obstacle(), 
                                    row.upper_bound.clear_50_ft_obstacle(), 
                                    "'")
                                %}
                            {% endif %}
                            {{row.middle_value.clear_50_ft_obstacle()}}'
                        </td>
                        <td>
                            {% if i == 1 %}
                                {% call percent_of::render(
                                    cessna.headwind_tween_percentage,
                                    calcs.takeoff_distances[0].upper_bound.ground_run(), 
                                    calcs.takeoff_distances[2].upper_bound.ground_run(), 
                                    "'")
                                %}
                            {% endif %}
                            {{row.upper_bound.ground_run()}}'
                        </td>
                        <td>
                            {% if i == 1 %}
                                {% call percent_of::render(
                                    cessna.headwind_tween_percentage,
                                    calcs.takeoff_distances[0].upper_bound.clear_50_ft_obstacle(), 
                                    calcs.takeoff_distances[2].upper_bound.clear_50_ft_obstacle(), 
                                    "'")
                                %}
                            {% endif %}
                            {{row.upper_bound.clear_50_ft_obstacle()}}'
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </p>

        {% if calcs.correction.standard_temperature_correction_percentage != 0.0 %}
            <h3>Increase distances 10% for each 35째F in temperature above standard for the particular altitude.</h3>
            {% call temperature_correction::render(
                cessna.temperature_f, 
                cessna.standard_temperature_f, 
                cessna.temperature_f_diff_from_standard, 
                35, 
                calcs.correction.standard_temperature_correction_percentage, 
                calcs.takeoff_distances[1].middle_value.ground_run(), 
                calcs.correction.distance_corrected_for_temperature.ground_run(), 
                calcs.takeoff_distances[1].middle_value.clear_50_ft_obstacle(), 
                calcs.correction.distance_corrected_for_temperature.clear_50_ft_obstacle()) 
            %}
        {% endif %}
        {% if is_grass %}
            <h3>For operation on a dry, grass runway increase distances (both "Ground Run" and "Total to Clear 50' Obstacle" by 7% of the "Total to Clear 50' Obstacle") figure.</h3>
            {% call grass_correction::render(
                calcs.correction.distance_corrected_for_temperature.clear_50_ft_obstacle(),
                0.07,
                calcs.correction.grass_offset,
                calcs.correction.distance_corrected_for_temperature.ground_run(),
                calcs.correction.distance_corrected_for_grass.ground_run(),
                calcs.correction.distance_corrected_for_grass.clear_50_ft_obstacle())
            %}
        {% endif %}
    </body>
</html>